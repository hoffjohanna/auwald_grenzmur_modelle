<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Zeigerarten und Risikofaktoren im Auwald an der Grenzmur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- OpenLayers -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.5.2/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@7.5.2/dist/ol.js"></script>
  <style>
    html, body { margin:0; height:100%; font-family: system-ui, Arial, sans-serif; }
    header {
      text-align:center; padding:12px; background:#f0f0f0; border-bottom:1px solid #ccc;
      font-size:18px; font-weight:600;
    }
    #map { height: calc(95% - 100px); position: relative; }
    
	
footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 5px;
  padding: 10px 10px;
  background: #f8f8f8;
  border-top: 1px solid #ddd;
  font-size: 11px;
}

.footer-logos {
  display: flex;
  align-items: center;
  gap: 12px;
}

footer img {
  height: 45px;        /* einheitliche Höhe */
  width: auto;         /* Proportionen beibehalten */
  object-fit: contain; /* falls Logo sehr breit/hoch ist */
}

.footer-text {
  color: #333;
}

/* Auf schmalen Screens untereinander anordnen */
@media (max-width: 600px) {
  footer { flex-direction: column; text-align: center; }
}
	
	
	/* Verhindert die Deprecation-Warnung für OL-Canvas */
	#map canvas { overflow: hidden !important; }
/* === PANELS: NEU hinzugefügt === */
.control-stack {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.control-panel {
  background: rgba(255,255,255,.95);
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
  overflow: hidden;
  min-width: 260px;
  font: 14px system-ui, Arial, sans-serif;
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 10px;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
}

.panel-header:hover {
  background: #f6f6f6;
}

.panel-title {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.panel-toggle {
  font-size: 18px;
  line-height: 1;
  transform: translateY(-1px);
}

.panel-body {
  padding: 8px 10px;
  border-top: 1px solid #eee;
}

.panel-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 6px 0;
}

/* einheitliche Checkbox-Größe (optional) */
.panel-body input[type="checkbox"] {
  width: 16px;
  height: 16px;
}





/* === LEGENDE: Verbreitungskarten === */
.legend {
  position: absolute;
  right: 12px;
  bottom: 80px;       /* oberhalb des Footers */
  z-index: 1001;
  background: rgba(255,255,255,.95);
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px 10px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
  font: 14px system-ui, Arial, sans-serif;
  max-width: 280px;
}
.legend .legend-title {
  font-weight: 600;
  margin-bottom: 6px;
}
.legend img {
  display: block;
  max-width: 100%;
  height: auto;
}



  </style>
</head>
<body>
  <header>Zeigerarten und Risikofaktoren im Auwald an der Grenzmur</header>
  <div id="map"></div>
  <footer>
  <div class="footer-logos">
    <a href="https://www.bfw.gv.at/" target="_blank" rel="noopener">
      <img src="bfw_black.jpg" alt="BFW" loading="lazy" height="60">
    </a>
    <a href="https://www.oekoteam.at/de/" target="_blank" rel="noopener">
      <img src="https://www.oekoteam.at/images/oekologos/oekoteamlogtransp210.png" alt="Ökoteam" loading="lazy" height="60">
    </a>
    <a href="https://www.nukv.at/" target="_blank" rel="noopener">
      <img src="NUKV_Logo_basic.png" alt="NUKV_Logo_basic" loading="lazy" height="60">
    </a>    
	<a href="https://www.bmluk.gv.at/" target="_blank" rel="noopener">
      <img src="BMLUK_Logo_cmyk.png" alt="BMLUK" loading="lazy" height="60">
    </a>
    <a href=" " target="_blank" rel="noopener">
      <img src="Europaeischen_Union_POS.jpg" alt="Europaeischen_Union_POS" loading="lazy" height="60">
    </a>

  </div>
<div class="footer-text"> 
<strong> Auen-Renaturierung im Europaschutzgebiet Steirische Grenzmur  </strong> <br>
    <strong>Durchführung:</strong> ÖKOTEAM & BFW  <br>
    <strong>Projektträger:</strong> NUKV Steiermark <br>
	<strong>Förderung:</strong> Biodiversitätsfonds des BMLUK<br>


</div>

  <script>
    // ===== Orthofoto-Block =====
    // Orthofoto-Basemap (WMTS REST)
    const wmtsSource = new ol.source.WMTS({
      urls: [
        'https://mapsneu.wien.gv.at/basemap/bmaporthofoto30cm/{Style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}.jpeg'
      ],
      layer: 'bmaporthofoto30cm',
      matrixSet: 'google3857',
      format: 'image/jpeg',
      style: 'normal',
      requestEncoding: 'REST',
      tileGrid: new ol.tilegrid.WMTS({
        origin: ol.extent.getTopLeft(ol.proj.get('EPSG:3857').getExtent()),
        resolutions: Array.from({length: 20}, (_, z) => 156543.03392804097 / Math.pow(2, z)),
        matrixIds: Array.from({length: 20}, (_, z) => String(z))
      }),
      attributions: 'Basemap: <a href="https://www.basemap.at" target="_blank" rel="noopener">basemap.at</a>'
    });

    const map = new ol.Map({
      target: 'map',
      layers: [ new ol.layer.Tile({ source: wmtsSource }) ],
      view: new ol.View({
        projection: 'EPSG:3857',
        center: [1771934,5895892], //  1765886,5897699
        zoom: 12
      })
    });




    // =====  WMS-Overlays: SDM und Risikokarten ===== 
    const WMS_URL = 'https://gis.stmk.gv.at/arcgis/services/OGD/ALSHoeheninformation_1m_UTM33N/MapServer/WMSServer';

    // Oberflächenschummerung
    const lyrSchummerung = new ol.layer.Tile({
      source: new ol.source.TileWMS({
        url: WMS_URL,
        params: {
          'LAYERS': 'Oberflaechenschummerung',
          'FORMAT': 'image/png',
          'TRANSPARENT': true,
          'VERSION': '1.3.0',
          'TILED': true
        },
        crossOrigin: 'anonymous'
      }),
      visible: false,
      opacity: 0.8,
      zIndex: 10
    });
	

    // Oberflaechenhoehe_Projekte
    const lyrHoeheProj = new ol.layer.Tile({
      source: new ol.source.TileWMS({
        url: WMS_URL,
        params: {
          'LAYERS': 'Oberflaechenhoehe_Projekte',
          'FORMAT': 'image/png',
          'TRANSPARENT': true,
          'VERSION': '1.3.0',
          'TILED': true
        },
        crossOrigin: 'anonymous'
      }),
      visible: false,
      opacity: 0.8,
      zIndex: 11
    });
	
	// Bombina Verteilung 
    const lyrBombina_const = new ol.layer.Tile({
      source: new ol.source.TileWMS({
        url: 'https://inspire.lfrz.gv.at/000602/wms',
        params: {
          'LAYERS': '000602:Bombina_Modell_cont',//ändern
          'FORMAT': 'image/png',
          'TRANSPARENT': true,
          'VERSION': '1.3.0',
          'TILED': true,
		  //'STYLES': 'Bmbn_BY_style' // definierte Legendarstellung
        },
        crossOrigin: 'anonymous'
      }),
      visible: false,
      opacity: 0.8,
      zIndex: 11
    });


// === NEU: Hirschkäfer (WMS) === ***LAYER_STEP1
const lyrHirschkaefer = new ol.layer.Tile({
  source: new ol.source.TileWMS({
    url: 'https://inspire.lfrz.gv.at/000602/wms',           
    params: {
      'LAYERS': '000602:Lucanus_Modell_cont',      //ändern
      'FORMAT': 'image/png',
      'TRANSPARENT': true,
      'VERSION': '1.3.0',
      'TILED': true,
	  //'STYLES': 'Lcn_BY_style'
	  },
    crossOrigin: 'anonymous'
  }),
  visible: false,
  opacity: 0.8,
  zIndex: 11
});
lyrHirschkaefer.setVisible(true);

//Scharlachkäfer (WMS)
const lyrScharlachkaefer = new ol.layer.Tile({
  source: new ol.source.TileWMS({
    url: 'https://inspire.lfrz.gv.at/000602/wms',           
    params: {
      'LAYERS': '000602:Cucujus_Modell_cont',      //ändern
      'FORMAT': 'image/png',
      'TRANSPARENT': true,
      'VERSION': '1.3.0',
      'TILED': true,
	  //'STYLES': 'Lcn_BY_style'
	  },
    crossOrigin: 'anonymous'
  }),
  visible: false,
  opacity: 0.8,
  zIndex: 11
});

//Mittelspecht (WMS)
const lyrMittelspecht = new ol.layer.Tile({
  source: new ol.source.TileWMS({
    url: 'https://inspire.lfrz.gv.at/000602/wms',           
    params: {
      'LAYERS': '000602:Leiopicus_Modell_cont',      //ändern
      'FORMAT': 'image/png',
      'TRANSPARENT': true,
      'VERSION': '1.3.0',
      'TILED': true,
	  //'STYLES': 'Lcn_BY_style'
	  },
    crossOrigin: 'anonymous'
  }),
  visible: false,
  opacity: 0.8,
  zIndex: 11
});


//Grauspecht
const lyrGrauspecht = new ol.layer.Tile({
  source: new ol.source.TileWMS({
    url: 'https://inspire.lfrz.gv.at/000602/wms',           
    params: {
      'LAYERS': '000602:Picus_Modell_cont',      //ändern
      'FORMAT': 'image/png',
      'TRANSPARENT': true,
      'VERSION': '1.3.0',
      'TILED': true,
	  //'STYLES': 'Lcn_BY_style'
	  },
    crossOrigin: 'anonymous'
  }),
  visible: false,
  opacity: 0.8,
  zIndex: 11
});

//Kammmolch
const lyrKammmolch = new ol.layer.Tile({
  source: new ol.source.TileWMS({
    url: 'https://inspire.lfrz.gv.at/000602/wms',           
    params: {
      'LAYERS': '000602:Triturus_Modell_cont',      //ändern
      'FORMAT': 'image/png',
      'TRANSPARENT': true,
      'VERSION': '1.3.0',
      'TILED': true,
	  //'STYLES': 'Lcn_BY_style'
	  },
    crossOrigin: 'anonymous'
  }),
  visible: false,
  opacity: 0.8,
  zIndex: 11
});


// Debug: Fehlermeldungen im Browser-Console-Log
//lyrHirschkaefer.getSource().on('tileloaderror', (e) => {
//  console.error('Hirschkäfer WMS tileloaderror', e);
//});
//lyrHirschkaefer.getSource().on('tileloadstart', (e) => {
//  console.log('Hirschkäfer WMS tile URL:', e.tile.getKey()); // bei Bedarf aktivieren
//});





	 // Overlays zur Karte hinzufügen ***LAYER_STEP2
    map.addLayer(lyrSchummerung);
    map.addLayer(lyrHoeheProj);
	map.addLayer(lyrBombina_const);
	map.addLayer(lyrHirschkaefer);
	map.addLayer(lyrScharlachkaefer);
	map.addLayer(lyrMittelspecht);	
	map.addLayer(lyrGrauspecht);	
	map.addLayer(lyrKammmolch);

	
	
	
	
	
	
	
// === LEGENDE: NEU Vebreitungskarten ===
const legendUrl = 'https://inspire.lfrz.gv.at/000602/ows?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=Bombina_Modell_cont&style=Bmbn_BY_style';

const legendDiv = document.createElement('div');
legendDiv.className = 'legend';
legendDiv.innerHTML = `
  <div class="legend-title">Verbreitungs-<br>Wahrscheinlichkeit
  <div>
  <img src="${legendUrl}" alt="Legende: Artvorkommen – Wahrscheinlichkeit">
`;
//legendDiv.style.display = 'none'; // anfangs ausgeblendet
document.getElementById('map').appendChild(legendDiv);	
	
	
	
	
// === PANELS: 2 separate zum Ausklappen hinzugefügt  ===

// Container für beide Panels (gestapelt)
const stack = document.createElement('div');
stack.className = 'control-stack';
document.getElementById('map').appendChild(stack);

// Hilfsfunktion: kollabierbares Panel erzeugen
function createPanel({ title, defaultOpen = true }) {
  const panel = document.createElement('div');
  panel.className = 'control-panel';

  const header = document.createElement('div');
  header.className = 'panel-header';
  header.setAttribute('role', 'button');
  header.setAttribute('tabindex', '0');
  header.setAttribute('aria-expanded', String(defaultOpen));

  const titleEl = document.createElement('div');
  titleEl.className = 'panel-title';
  titleEl.textContent = title;

  const toggle = document.createElement('div');
  toggle.className = 'panel-toggle';
  toggle.textContent = defaultOpen ? '▾' : '▸';

  const body = document.createElement('div');
  body.className = 'panel-body';
  if (!defaultOpen) body.style.display = 'none';

  header.addEventListener('click', () => {
    const open = body.style.display !== 'none';
    body.style.display = open ? 'none' : 'block';
    toggle.textContent = open ? '▸' : '▾';
    header.setAttribute('aria-expanded', String(!open));
  });
  header.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      header.click();
    }
  });

  header.appendChild(titleEl);
  header.appendChild(toggle);
  panel.appendChild(header);
  panel.appendChild(body);
  return { panel, body };
}





// Panel 1: Verbreitungskarten (oben) ---Reihenfolge bestimmen
const { panel: panelV, body: bodyV } = createPanel({
  title: 'Verbreitungskarten',
  defaultOpen: true
});



//Checkbox Lucanus ***LAYER_STEP3
const rowHirsch = document.createElement('label');
rowHirsch.className = 'panel-row';
rowHirsch.innerHTML = `
  <input type="checkbox" id="chk_hirsch"> Hirschkäfer
`;
bodyV.appendChild(rowHirsch);

//Checkbox cucujus ***LAYER_STEP3
const rowScharlachkaefer = document.createElement('label');
rowScharlachkaefer.className = 'panel-row';
rowScharlachkaefer.innerHTML = `
  <input type="checkbox" id="chk_Scharlachkaefer">Scharlachkaefer
`;
bodyV.appendChild(rowScharlachkaefer);

//Checkbox Leiopicus ***LAYER_STEP3
const rowMittelspecht = document.createElement('label');
rowMittelspecht.className = 'panel-row';
rowMittelspecht.innerHTML = `
  <input type="checkbox" id="chk_Mittelspecht"> Mittelspecht
`;
bodyV.appendChild(rowMittelspecht);

//Checkbox Picus ***LAYER_STEP3
const rowGrauspecht = document.createElement('label');
rowGrauspecht.className = 'panel-row';
rowGrauspecht.innerHTML = `
  <input type="checkbox" id="chk_Grauspecht"> Grauspecht
`;
bodyV.appendChild(rowGrauspecht);


//Checkbox Triturus ***LAYER_STEP3
const rowKammmolch = document.createElement('label');
rowKammmolch.className = 'panel-row';
rowKammmolch.innerHTML = `
  <input type="checkbox" id="chk_Kammmolch"> Kammmolch
`;
bodyV.appendChild(rowKammmolch);


// Checkbox für Bombina (weitere Layer später ergänzen)
const rowBombina = document.createElement('label');
rowBombina.className = 'panel-row';
rowBombina.innerHTML = `
  <input type="checkbox" id="chk_bombina"> Gelbbauchunke
`;
bodyV.appendChild(rowBombina);







// Panel 2: Risikokarten (darunter)
const { panel: panelR, body: bodyR } = createPanel({
  title: 'Risikokarten',
  defaultOpen: true
});

const rowSchummer = document.createElement('label');
rowSchummer.className = 'panel-row';
rowSchummer.innerHTML = `
  <input type="checkbox" id="chk_schummerung"> Oberflächenschummerung (Steiermark)
`;
bodyR.appendChild(rowSchummer);

const rowHoehe = document.createElement('label');
rowHoehe.className = 'panel-row';
rowHoehe.innerHTML = `
  <input type="checkbox" id="chk_hoeheproj"> Oberflächenhöhe Projekte
`;
bodyR.appendChild(rowHoehe);




// Beide Panels in den Stack einfügen
stack.appendChild(panelV); //Verbreitung
stack.appendChild(panelR); //Risiko




// Checkbox-Referenzen & Logik ***STEP4
const chkBombina = bodyV.querySelector('#chk_bombina');
const chkHirsch = bodyV.querySelector('#chk_hirsch');
const chkScharlachkaefer = bodyV.querySelector('#chk_Scharlachkaefer');
const chkMittelspecht= bodyV.querySelector('#chk_Mittelspecht');
const chkGrauspecht = bodyV.querySelector('#chk_Grauspecht');
const chkKammmolch = bodyV.querySelector('#chk_Kammmolch');

const chkSchummerung = bodyR.querySelector('#chk_schummerung');
const chkHoeheProj = bodyR.querySelector('#chk_hoeheproj');






//Set Visibility ***STEP5
chkBombina.addEventListener('change', () => {
  lyrBombina_const.setVisible(chkBombina.checked);
    //legendDiv.style.display = chkBombina.checked ? 'block' : 'none'; 
	// === LEGENDE Verbreitungskarten ===
});

chkHirsch.addEventListener('change', () => {
  lyrHirschkaefer.setVisible(chkHirsch.checked);

});

chkScharlachkaefer.addEventListener('change', () => {
  lyrScharlachkaefer.setVisible(chkScharlachkaefer.checked);

});

chkMittelspecht.addEventListener('change', () => {
  lyrMittelspecht.setVisible(chkMittelspecht.checked);

});

chkGrauspecht.addEventListener('change', () => {
  lyrGrauspecht.setVisible(chkGrauspecht.checked);

});

chkKammmolch.addEventListener('change', () => {
  lyrKammmolch.setVisible(chkKammmolch.checked);

});



chkSchummerung.addEventListener('change', () => {
  lyrSchummerung.setVisible(chkSchummerung.checked);
});
chkHoeheProj.addEventListener('change', () => {
  lyrHoeheProj.setVisible(chkHoeheProj.checked);
});

// Optional: Defaults setzen (z. B. beim Laden aktivieren)
//chkBombina.checked = true;
chkHirsch.checked = true;
lyrHirschkaefer.setVisible(true);
legendDiv.style.display = 'block';
/// lyrSchummerung.setVisible(true);  chkSchummerung.checked = true;
/// lyrHoeheProj.setVisible(true);    chkHoeheProj.checked = true;
	
	
	
	
	
	
	
	
	
    // Maßstabsleiste hinzufügen
    map.addControl(new ol.control.ScaleLine());

  </script>
</body>
</html>
